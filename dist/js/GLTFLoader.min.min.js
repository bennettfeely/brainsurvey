THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.dracoLoader=null}function a(){var t={};return{get:function(e){return t[e]},add:function(e,r){t[e]=r},remove:function(e){delete t[e]},removeAll:function(){t={}}}}e.prototype={constructor:e,crossOrigin:"anonymous",load:function(r,t,e,a){var n,i=this;n=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(r),i.manager.itemStart(r);var s=function(e){a?a(e):console.error(e),i.manager.itemEnd(r),i.manager.itemError(r)},o=new THREE.FileLoader(i.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.load(r,function(e){try{i.parse(e,n,function(e){t(e),i.manager.itemEnd(r)},s)}catch(e){s(e)}},e,s)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(e,r,s,t){var a,o={};if("string"==typeof e)a=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===f){try{o[_.KHR_BINARY_GLTF]=new m(e)}catch(e){return void(t&&t(e))}a=o[_.KHR_BINARY_GLTF].content}else a=THREE.LoaderUtils.decodeText(new Uint8Array(e));var n=JSON.parse(a);if(void 0===n.asset||n.asset.version[0]<2)t&&t(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(n.extensionsUsed)for(var i=0;i<n.extensionsUsed.length;++i){var l=n.extensionsUsed[i],u=n.extensionsRequired||[];switch(l){case _.KHR_LIGHTS_PUNCTUAL:o[l]=new d(n);break;case _.KHR_MATERIALS_UNLIT:o[l]=new h(n);break;case _.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[l]=new v;break;case _.KHR_DRACO_MESH_COMPRESSION:o[l]=new E(n,this.dracoLoader);break;case _.MSFT_TEXTURE_DDS:o[_.MSFT_TEXTURE_DDS]=new c;break;default:0<=u.indexOf(l)&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}var p=new C(n,o,{path:r||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});p.parse(function(e,r,t,a,n){var i={scene:e,scenes:r,cameras:t,animations:a,asset:n.asset,parser:p,userData:{}};w(o,i,n),s(i)},t)}}};var _={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function c(){if(!THREE.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=_.MSFT_TEXTURE_DDS,this.ddsLoader=new THREE.DDSLoader}function d(e){this.name=_.KHR_LIGHTS_PUNCTUAL,this.lights=[];for(var r=(e.extensions&&e.extensions[_.KHR_LIGHTS_PUNCTUAL]||{}).lights||[],t=0;t<r.length;t++){var a,n=r[t],i=new THREE.Color(16777215);void 0!==n.color&&i.fromArray(n.color);var s=void 0!==n.range?n.range:0;switch(n.type){case"directional":(a=new THREE.DirectionalLight(i)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new THREE.PointLight(i)).distance=s;break;case"spot":(a=new THREE.SpotLight(i)).distance=s,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,a.angle=n.spot.outerConeAngle,a.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}a.decay=2,void 0!==n.intensity&&(a.intensity=n.intensity),a.name=n.name||"light_"+t,this.lights.push(a)}}function h(e){this.name=_.KHR_MATERIALS_UNLIT}h.prototype.getMaterialType=function(e){return THREE.MeshBasicMaterial},h.prototype.extendParams=function(e,r,t){var a=[];e.color=new THREE.Color(1,1,1),e.opacity=1;var n=r.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){var i=n.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}void 0!==n.baseColorTexture&&a.push(t.assignTexture(e,"map",n.baseColorTexture.index))}return Promise.all(a)};var f="glTF",l=12,u={JSON:1313821514,BIN:5130562};function m(e){this.name=_.KHR_BINARY_GLTF,this.content=null,this.body=null;var r=new DataView(e,0,l);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var t=new DataView(e,l),a=0;a<t.byteLength;){var n=t.getUint32(a,!0);a+=4;var i=t.getUint32(a,!0);if(a+=4,i===u.JSON){var s=new Uint8Array(e,l+a,n);this.content=THREE.LoaderUtils.decodeText(s)}else if(i===u.BIN){var o=l+a;this.body=e.slice(o,o+n)}a+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function E(e,r){if(!r)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=_.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=r}function v(){return{name:_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,r,t){var a=r.extensions[this.name],n=THREE.ShaderLib.standard,i=THREE.UniformsUtils.clone(n.uniforms),s=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),p=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c=n.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",s).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",p);delete i.roughness,delete i.metalness,delete i.roughnessMap,delete i.metalnessMap,i.specular={value:(new THREE.Color).setHex(1118481)},i.glossiness={value:.5},i.specularMap={value:null},i.glossinessMap={value:null},e.vertexShader=n.vertexShader,e.fragmentShader=c,e.uniforms=i,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(a.diffuseFactor)){var h=a.diffuseFactor;e.color.fromArray(h),e.opacity=h[3]}if(void 0!==a.diffuseTexture&&d.push(t.assignTexture(e,"map",a.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==a.glossinessFactor?a.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),void 0!==a.specularGlossinessTexture){var f=a.specularGlossinessTexture.index;d.push(t.assignTexture(e,"glossinessMap",f)),d.push(t.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var r=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return r.isGLTFSpecularGlossinessMaterial=!0,r.color=e.color,r.map=void 0===e.map?null:e.map,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=void 0===e.aoMap?null:e.aoMap,r.aoMapIntensity=1,r.emissive=e.emissive,r.emissiveIntensity=1,r.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,r.bumpMap=void 0===e.bumpMap?null:e.bumpMap,r.bumpScale=1,r.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(r.normalScale=e.normalScale),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=void 0===e.specularMap?null:e.specularMap,r.specular=e.specular,r.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,r.glossiness=e.glossiness,r.alphaMap=null,r.envMap=void 0===e.envMap?null:e.envMap,r.envMapIntensity=1,r.refractionRatio=.98,r.extensions.derivatives=!0,r},cloneMaterial:function(e){var r=e.clone();r.isGLTFSpecularGlossinessMaterial=!0;for(var t=this.specularGlossinessParams,a=0,n=t.length;a<n;a++)r[t[a]]=e[t[a]];return r},refreshUniforms:function(e,r,t,a,n,i){if(!0===n.isGLTFSpecularGlossinessMaterial){var s,o=n.uniforms,l=n.defines;o.opacity.value=n.opacity,o.diffuse.value.copy(n.color),o.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),o.map.value=n.map,o.specularMap.value=n.specularMap,o.alphaMap.value=n.alphaMap,o.lightMap.value=n.lightMap,o.lightMapIntensity.value=n.lightMapIntensity,o.aoMap.value=n.aoMap,o.aoMapIntensity.value=n.aoMapIntensity,n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.glossinessMap?s=n.glossinessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap&&(s=n.emissiveMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),o.uvTransform.value.copy(s.matrix)),o.envMap.value=n.envMap,o.envMapIntensity.value=n.envMapIntensity,o.flipEnvMap.value=n.envMap&&n.envMap.isCubeTexture?-1:1,o.refractionRatio.value=n.refractionRatio,o.specular.value.copy(n.specular),o.glossiness.value=n.glossiness,o.glossinessMap.value=n.glossinessMap,o.emissiveMap.value=n.emissiveMap,o.bumpMap.value=n.bumpMap,o.normalMap.value=n.normalMap,o.displacementMap.value=n.displacementMap,o.displacementScale.value=n.displacementScale,o.displacementBias.value=n.displacementBias,null!==o.glossinessMap.value&&void 0===l.USE_GLOSSINESSMAP&&(l.USE_GLOSSINESSMAP="",l.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==l.USE_GLOSSINESSMAP&&(delete l.USE_GLOSSINESSMAP,delete l.USE_ROUGHNESSMAP)}}}}function S(e,r,t,a){THREE.Interpolant.call(this,e,r,t,a)}E.prototype.decodePrimitive=function(e,r){var t=this.json,a=this.dracoLoader,n=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,s={},o={},l={};for(var u in i)u in R&&(s[R[u]]=i[u]);for(u in e.attributes)if(void 0!==R[u]&&void 0!==i[u]){var p=t.accessors[e.attributes[u]],c=L[p.componentType];l[R[u]]=c,o[R[u]]=!0===p.normalized}return r.getDependency("bufferView",n).then(function(e){return new Promise(function(n){a.decodeDracoFile(e,function(e){for(var r in e.attributes){var t=e.attributes[r],a=o[r];void 0!==a&&(t.normalized=a)}n(e)},s,l)})})},((S.prototype=Object.create(THREE.Interpolant.prototype)).constructor=S).prototype.beforeStart_=S.prototype.copySampleValue_=function(e){for(var r=this.resultBuffer,t=this.sampleValues,a=this.valueSize,n=e*a*3+a,i=0;i!==a;i++)r[i]=t[n+i];return r},S.prototype.afterEnd_=S.prototype.copySampleValue_,S.prototype.interpolate_=function(e,r,t,a){for(var n=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,u=a-r,p=(t-r)/u,c=p*p,d=c*p,h=e*l,f=h-l,m=2*d-3*c+1,E=d-2*c+p,v=-2*d+3*c,T=d-c,g=0;g!==s;g++){var R=i[f+g+s],M=i[f+g+o]*u,S=i[h+g+s],y=i[h+g]*u;n[g]=m*R+E*M+v*S+T*y}return n};var L=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),T={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},g={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},A=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),R={POSITION:"position",NORMAL:"normal",TEXCOORD_0:"uv",TEXCOORD0:"uv",TEXCOORD:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",COLOR0:"color",COLOR:"color",WEIGHTS_0:"skinWeight",WEIGHT:"skinWeight",JOINTS_0:"skinIndex",JOINT:"skinIndex"},y={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},H={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},M={"image/png":THREE.RGBAFormat,"image/jpeg":THREE.RGBFormat};function b(e,r){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:r+e}function w(e,r,t){for(var a in t.extensions)void 0===e[a]&&(r.userData.gltfExtensions=r.userData.gltfExtensions||{},r.userData.gltfExtensions[a]=t.extensions[a])}function x(e,r){void 0!==r.extras&&("object"==typeof r.extras?e.userData=r.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras))}function I(e,r){if(e.updateMorphTargets(),void 0!==r.weights)for(var t=0,a=r.weights.length;t<a;t++)e.morphTargetInfluences[t]=r.weights[t];if(r.extras&&Array.isArray(r.extras.targetNames)){var n=r.extras.targetNames;if(e.morphTargetInfluences.length===n.length)for(e.morphTargetDictionary={},t=0,a=n.length;t<a;t++)e.morphTargetDictionary[n[t]]=t;else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function p(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var t in e)if(e[t]!==r[t])return!1;return!0}function F(e,r){if(e.length!==r.length)return!1;for(var t=0,a=e.length;t<a;t++)if(e[t]!==r[t])return!1;return!0}function G(e,r){for(var t=0,a=e.length;t<a;t++){var n=e[t];if(s=r,(i=n.primitive).indices===s.indices&&p(i.attributes,s.attributes))return n.promise}var i,s;return null}function U(e){if(e.isInterleavedBufferAttribute){for(var r=e.count,t=e.itemSize,a=e.array.slice(0,r*t),n=0;n<r;++n)a[n]=e.getX(n),2<=t&&(a[n+1]=e.getY(n)),3<=t&&(a[n+2]=e.getZ(n)),4<=t&&(a[n+3]=e.getW(n));return new THREE.BufferAttribute(a,t,e.normalized)}return e.clone()}function C(e,r,t){this.json=e||{},this.extensions=r||{},this.options=t||{},this.cache=new a,this.primitiveCache=[],this.multiplePrimitivesCache=[],this.multiPassGeometryCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function D(e,r,t){var a=r.attributes;for(var n in a){var i=R[n],s=t[a[n]];i&&(i in e.attributes||e.addAttribute(i,s))}void 0===r.indices||e.index||e.setIndex(t[r.indices]),void 0!==r.targets&&function(e,r,t){for(var a=!1,n=!1,i=0,s=r.length;i<s&&(void 0!==(u=r[i]).POSITION&&(a=!0),void 0!==u.NORMAL&&(n=!0),!a||!n);i++);if(a||n){var o=[],l=[];for(i=0,s=r.length;i<s;i++){var u=r[i],p="morphTarget"+i;if(a){if(void 0!==u.POSITION){var c=U(t[u.POSITION]);c.name=p;for(var d=e.attributes.position,h=0,f=c.count;h<f;h++)c.setXYZ(h,c.getX(h)+d.getX(h),c.getY(h)+d.getY(h),c.getZ(h)+d.getZ(h))}else c=e.attributes.position;o.push(c)}if(n){if(void 0!==u.NORMAL){var m;(m=U(t[u.NORMAL])).name=p;var E=e.attributes.normal;for(h=0,f=m.count;h<f;h++)m.setXYZ(h,m.getX(h)+E.getX(h),m.getY(h)+E.getY(h),m.getZ(h)+E.getZ(h))}else m=e.attributes.normal;l.push(m)}}a&&(e.morphAttributes.position=o),n&&(e.morphAttributes.normal=l)}}(e,r.targets,t),x(e,r)}return C.prototype.parse=function(i,e){var s=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(e){var r=e.scenes||[],t=r[s.scene||0],a=e.animations||[],n=e.cameras||[];i(t,r,n,a,s)}).catch(e)},C.prototype.markDefs=function(){for(var e=this.json.nodes||[],r=this.json.skins||[],t=this.json.meshes||[],a={},n={},i=0,s=r.length;i<s;i++)for(var o=r[i].joints,l=0,u=o.length;l<u;l++)e[o[l]].isBone=!0;for(var p=0,c=e.length;p<c;p++){var d=e[p];void 0!==d.mesh&&(void 0===a[d.mesh]&&(a[d.mesh]=n[d.mesh]=0),a[d.mesh]++,void 0!==d.skin&&(t[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=a,this.json.meshUses=n},C.prototype.getDependency=function(e,r){var t=e+":"+r,a=this.cache.get(t);if(!a){switch(e){case"scene":a=this.loadScene(r);break;case"node":a=this.loadNode(r);break;case"mesh":a=this.loadMesh(r);break;case"accessor":a=this.loadAccessor(r);break;case"bufferView":a=this.loadBufferView(r);break;case"buffer":a=this.loadBuffer(r);break;case"material":a=this.loadMaterial(r);break;case"texture":a=this.loadTexture(r);break;case"skin":a=this.loadSkin(r);break;case"animation":a=this.loadAnimation(r);break;case"camera":a=this.loadCamera(r);break;default:throw new Error("Unknown type: "+e)}this.cache.add(t,a)}return a},C.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var a=this,r=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(r.map(function(e,r){return a.getDependency(t,r)})),this.cache.add(t,e)}return e},C.prototype.getMultiDependencies=function(e){for(var t={},r=[],a=0,n=e.length;a<n;a++){var i=e[a],s=this.getDependencies(i);s=s.then(function(e,r){t[e]=r}.bind(this,i+("mesh"===i?"es":"s"))),r.push(s)}return Promise.all(r).then(function(){return t})},C.prototype.loadBuffer=function(e){var t=this.json.buffers[e],a=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[_.KHR_BINARY_GLTF].body);var n=this.options;return new Promise(function(e,r){a.load(b(t.uri,n.path),e,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})},C.prototype.loadBufferView=function(e){var a=this.json.bufferViews[e];return this.getDependency("buffer",a.buffer).then(function(e){var r=a.byteLength||0,t=a.byteOffset||0;return e.slice(t,t+r)})},C.prototype.loadAccessor=function(e){var S=this,y=this.json,H=this.json.accessors[e];if(void 0===H.bufferView&&void 0===H.sparse)return null;var r=[];return void 0!==H.bufferView?r.push(this.getDependency("bufferView",H.bufferView)):r.push(null),void 0!==H.sparse&&(r.push(this.getDependency("bufferView",H.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",H.sparse.values.bufferView))),Promise.all(r).then(function(e){var r,t,a=e[0],n=A[H.type],i=L[H.componentType],s=i.BYTES_PER_ELEMENT,o=s*n,l=H.byteOffset||0,u=void 0!==H.bufferView?y.bufferViews[H.bufferView].byteStride:void 0,p=!0===H.normalized;if(u&&u!==o){var c="InterleavedBuffer:"+H.bufferView+":"+H.componentType,d=S.cache.get(c);d||(r=new i(a),d=new THREE.InterleavedBuffer(r,u/s),S.cache.add(c,d)),t=new THREE.InterleavedBufferAttribute(d,n,l/s,p)}else r=null===a?new i(H.count*n):new i(a,l,H.count*n),t=new THREE.BufferAttribute(r,n,p);if(void 0!==H.sparse){var h=A.SCALAR,f=L[H.sparse.indices.componentType],m=H.sparse.indices.byteOffset||0,E=H.sparse.values.byteOffset||0,v=new f(e[1],m,H.sparse.count*h),T=new i(e[2],E,H.sparse.count*n);null!==a&&t.setArray(t.array.slice());for(var g=0,R=v.length;g<R;g++){var M=v[g];if(t.setX(M,T[g*n]),2<=n&&t.setY(M,T[g*n+1]),3<=n&&t.setZ(M,T[g*n+2]),4<=n&&t.setW(M,T[g*n+3]),5<=n)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return t})},C.prototype.loadTexture=function(e){var t,r=this,a=this.json,n=this.options,i=this.textureLoader,s=window.URL||window.webkitURL,o=a.textures[e],l=o.extensions||{},u=(t=l[_.MSFT_TEXTURE_DDS]?a.images[l[_.MSFT_TEXTURE_DDS].source]:a.images[o.source]).uri,p=!1;return void 0!==t.bufferView&&(u=r.getDependency("bufferView",t.bufferView).then(function(e){p=!0;var r=new Blob([e],{type:t.mimeType});return u=s.createObjectURL(r)})),Promise.resolve(u).then(function(t){var a=THREE.Loader.Handlers.get(t);return a||(a=l[_.MSFT_TEXTURE_DDS]?r.extensions[_.MSFT_TEXTURE_DDS].ddsLoader:i),new Promise(function(e,r){a.load(b(t,n.path),e,void 0,r)})}).then(function(e){!0===p&&s.revokeObjectURL(u),e.flipY=!1,void 0!==o.name&&(e.name=o.name),t.mimeType in M&&(e.format=M[t.mimeType]);var r=(a.samplers||{})[o.sampler]||{};return e.magFilter=T[r.magFilter]||THREE.LinearFilter,e.minFilter=T[r.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=g[r.wrapS]||THREE.RepeatWrapping,e.wrapT=g[r.wrapT]||THREE.RepeatWrapping,e})},C.prototype.assignTexture=function(r,t,e){return this.getDependency("texture",e).then(function(e){r[t]=e})},C.prototype.loadMaterial=function(e){var r,t=this,a=this.json,n=this.extensions,i=a.materials[e],s={},o=i.extensions||{},l=[];if(o[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=n[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=u.getMaterialType(i),l.push(u.extendParams(s,i,t))}else if(o[_.KHR_MATERIALS_UNLIT]){var p=n[_.KHR_MATERIALS_UNLIT];r=p.getMaterialType(i),l.push(p.extendParams(s,i,t))}else{r=THREE.MeshStandardMaterial;var c=i.pbrMetallicRoughness||{};if(s.color=new THREE.Color(1,1,1),s.opacity=1,Array.isArray(c.baseColorFactor)){var d=c.baseColorFactor;s.color.fromArray(d),s.opacity=d[3]}if(void 0!==c.baseColorTexture&&l.push(t.assignTexture(s,"map",c.baseColorTexture.index)),s.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,s.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture){var h=c.metallicRoughnessTexture.index;l.push(t.assignTexture(s,"metalnessMap",h)),l.push(t.assignTexture(s,"roughnessMap",h))}}!0===i.doubleSided&&(s.side=THREE.DoubleSide);var f=i.alphaMode||"OPAQUE";return"BLEND"===f?s.transparent=!0:(s.transparent=!1,"MASK"===f&&(s.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&r!==THREE.MeshBasicMaterial&&(l.push(t.assignTexture(s,"normalMap",i.normalTexture.index)),s.normalScale=new THREE.Vector2(1,1),void 0!==i.normalTexture.scale&&s.normalScale.set(i.normalTexture.scale,i.normalTexture.scale)),void 0!==i.occlusionTexture&&r!==THREE.MeshBasicMaterial&&(l.push(t.assignTexture(s,"aoMap",i.occlusionTexture.index)),void 0!==i.occlusionTexture.strength&&(s.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&r!==THREE.MeshBasicMaterial&&(s.emissive=(new THREE.Color).fromArray(i.emissiveFactor)),void 0!==i.emissiveTexture&&r!==THREE.MeshBasicMaterial&&l.push(t.assignTexture(s,"emissiveMap",i.emissiveTexture.index)),Promise.all(l).then(function(){var e;return e=r===THREE.ShaderMaterial?n[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new r(s),void 0!==i.name&&(e.name=i.name),e.normalScale&&(e.normalScale.y=-e.normalScale.y),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),e.specularMap&&(e.specularMap.encoding=THREE.sRGBEncoding),x(e,i),i.extensions&&w(n,e,i),e})},C.prototype.loadGeometries=function(f){var m,E=this,o=this.extensions,l=this.primitiveCache,v=function(e){if(e.length<2)return!1;var r=e[0],t=r.targets||[];if(void 0===r.indices)return!1;for(var a=1,n=e.length;a<n;a++){var i=e[a];if(r.mode!==i.mode)return!1;if(void 0===i.indices)return!1;if(!p(r.attributes,i.attributes))return!1;var s=i.targets||[];if(t.length!==s.length)return!1;for(var o=0,l=t.length;o<l;o++)if(!p(t[o],s[o]))return!1}return!0}(f);return v&&(f=[(m=f)[0]]),this.getDependencies("accessor").then(function(h){for(var e=[],r=0,t=f.length;r<t;r++){var a=f[r],n=G(l,a);if(n)e.push(n);else if(a.extensions&&a.extensions[_.KHR_DRACO_MESH_COMPRESSION]){var i=o[_.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,E).then(function(e){return D(e,a,h),e});l.push({primitive:a,promise:i}),e.push(i)}else{var s=new THREE.BufferGeometry;D(s,a,h),i=Promise.resolve(s),l.push({primitive:a,promise:i}),e.push(i)}}return Promise.all(e).then(function(e){if(v){var r=e[0];if(null!==(d=function(e,r,t){for(var a=0,n=e.length;a<n;a++){var i=e[a];if(r===i.baseGeometry&&F(t,i.primitives))return i.geometry}return null}(c=E.multiPassGeometryCache,r,m)))return[d.geometry];var t=new THREE.BufferGeometry;for(var a in t.name=r.name,t.userData=r.userData,r.attributes)t.addAttribute(a,r.attributes[a]);for(var a in r.morphAttributes)t.morphAttributes[a]=r.morphAttributes[a];for(var n=[],i=0,s=0,o=m.length;s<o;s++){for(var l=h[m[s].indices],u=0,p=l.count;u<p;u++)n.push(l.array[u]);t.addGroup(i,l.count,s),i+=l.count}return t.setIndex(n),c.push({geometry:t,baseGeometry:r,primitives:m}),[t]}if(1<e.length&&void 0!==THREE.BufferGeometryUtils){for(s=1,o=f.length;s<o;s++)if(f[0].mode!==f[s].mode)return e;var c,d;if(d=function(e,r){for(var t=0,a=e.length;t<a;t++){var n=e[t];if(F(r,n.baseGeometries))return n.geometry}return null}(c=E.multiplePrimitivesCache,e)){if(null!==d.geometry)return[d.geometry]}else if(t=THREE.BufferGeometryUtils.mergeBufferGeometries(e,!0),c.push({geometry:t,baseGeometries:e}),null!==t)return[t]}return e})})},C.prototype.loadMesh=function(H){var L=this,e=this.json,A=this.extensions,b=e.meshes[H];return this.getMultiDependencies(["accessor","material"]).then(function(e){for(var S=b.primitives,y=[],r=0,t=S.length;r<t;r++)y[r]=void 0===S[r].material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):e.materials[S[r].material];return L.loadGeometries(S).then(function(e){for(var r=1===e.length&&0<e[0].groups.length,t=[],a=0,n=e.length;a<n;a++){var i,s=e[a],o=S[a],l=r?y:y[a];if(4===o.mode||5===o.mode||6===o.mode||void 0===o.mode)i=!0===b.isSkinnedMesh?new THREE.SkinnedMesh(s,l):new THREE.Mesh(s,l),5===o.mode?i.drawMode=THREE.TriangleStripDrawMode:6===o.mode&&(i.drawMode=THREE.TriangleFanDrawMode);else if(1===o.mode)i=new THREE.LineSegments(s,l);else if(3===o.mode)i=new THREE.Line(s,l);else if(2===o.mode)i=new THREE.LineLoop(s,l);else{if(0!==o.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+o.mode);i=new THREE.Points(s,l)}0<Object.keys(i.geometry.morphAttributes).length&&I(i,b),i.name=b.name||"mesh_"+H,1<e.length&&(i.name+="_"+a),x(i,b),t.push(i);for(var u=r?i.material:[i.material],p=void 0!==s.attributes.color,c=void 0===s.attributes.normal,d=!0===i.isSkinnedMesh,h=0<Object.keys(s.morphAttributes).length,f=h&&void 0!==s.morphAttributes.normal,m=0,E=u.length;m<E;m++){if(l=u[m],i.isPoints){var v="PointsMaterial:"+l.uuid,T=L.cache.get(v);T||(T=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(T,l),T.color.copy(l.color),T.map=l.map,T.lights=!1,L.cache.add(v,T)),l=T}else if(i.isLine){v="LineBasicMaterial:"+l.uuid;var g=L.cache.get(v);g||(g=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(g,l),g.color.copy(l.color),g.lights=!1,L.cache.add(v,g)),l=g}if(p||c||d||h){v="ClonedMaterial:"+l.uuid+":",l.isGLTFSpecularGlossinessMaterial&&(v+="specular-glossiness:"),d&&(v+="skinning:"),p&&(v+="vertex-colors:"),c&&(v+="flat-shading:"),h&&(v+="morph-targets:"),f&&(v+="morph-normals:");var R=L.cache.get(v);R||(R=l.isGLTFSpecularGlossinessMaterial?A[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(l):l.clone(),d&&(R.skinning=!0),p&&(R.vertexColors=THREE.VertexColors),c&&(R.flatShading=!0),h&&(R.morphTargets=!0),f&&(R.morphNormals=!0),L.cache.add(v,R)),l=R}(u[m]=l).aoMap&&void 0===s.attributes.uv2&&void 0!==s.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),s.addAttribute("uv2",new THREE.BufferAttribute(s.attributes.uv.array,2))),l.isGLTFSpecularGlossinessMaterial&&(i.onBeforeRender=A[_.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms)}i.material=r?u:u[0]}if(1===t.length)return t[0];var M=new THREE.Group;for(a=0,n=t.length;a<n;a++)M.add(t[a]);return M})})},C.prototype.loadCamera=function(e){var r,t=this.json.cameras[e],a=t[t.type];if(a)return"perspective"===t.type?r=new THREE.PerspectiveCamera(THREE.Math.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):"orthographic"===t.type&&(r=new THREE.OrthographicCamera(a.xmag/-2,a.xmag/2,a.ymag/2,a.ymag/-2,a.znear,a.zfar)),void 0!==t.name&&(r.name=t.name),x(r,t),Promise.resolve(r);console.warn("THREE.GLTFLoader: Missing camera parameters.")},C.prototype.loadSkin=function(e){var r=this.json.skins[e],t={joints:r.joints};return void 0===r.inverseBindMatrices?Promise.resolve(t):this.getDependency("accessor",r.inverseBindMatrices).then(function(e){return t.inverseBindMatrices=e,t})},C.prototype.loadAnimation=function(R){var M=this.json.animations[R];return this.getMultiDependencies(["accessor","node"]).then(function(e){for(var r=[],t=0,a=M.channels.length;t<a;t++){var n=M.channels[t],i=M.samplers[n.sampler];if(i){var s=n.target,o=void 0!==s.node?s.node:s.id,l=void 0!==M.parameters?M.parameters[i.input]:i.input,u=void 0!==M.parameters?M.parameters[i.output]:i.output,p=e.accessors[l],c=e.accessors[u],d=e.nodes[o];if(d){var h;switch(d.updateMatrix(),d.matrixAutoUpdate=!0,y[s.path]){case y.weights:h=THREE.NumberKeyframeTrack;break;case y.rotation:h=THREE.QuaternionKeyframeTrack;break;case y.position:case y.scale:default:h=THREE.VectorKeyframeTrack}var f=d.name?d.name:d.uuid,m=void 0!==i.interpolation?H[i.interpolation]:THREE.InterpolateLinear,E=[];y[s.path]===y.weights?d.traverse(function(e){!0===e.isMesh&&e.morphTargetInfluences&&E.push(e.name?e.name:e.uuid)}):E.push(f);for(var v=0,T=E.length;v<T;v++){var g=new h(E[v]+"."+y[s.path],THREE.AnimationUtils.arraySlice(p.array,0),THREE.AnimationUtils.arraySlice(c.array,0),m);"CUBICSPLINE"===i.interpolation&&(g.createInterpolant=function(e){return new S(this.times,this.values,this.getValueSize()/3,e)},g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),r.push(g)}}}}return o=void 0!==M.name?M.name:"animation_"+R,new THREE.AnimationClip(o,void 0,r)})},C.prototype.loadNode=function(e){var r=this.json,o=this.extensions,l=r.meshReferences,u=r.meshUses,p=r.nodes[e];return this.getMultiDependencies(["mesh","skin","camera","light"]).then(function(e){var r;if(!0===p.isBone)r=new THREE.Bone;else if(void 0!==p.mesh){var t=e.meshes[p.mesh];if(1<l[p.mesh]){var a=u[p.mesh]++;(r=t.clone()).name+="_instance_"+a,r.onBeforeRender=t.onBeforeRender;for(var n=0,i=r.children.length;n<i;n++)r.children[n].name+="_instance_"+a,r.children[n].onBeforeRender=t.children[n].onBeforeRender}else r=t}else r=void 0!==p.camera?e.cameras[p.camera]:p.extensions&&p.extensions[_.KHR_LIGHTS_PUNCTUAL]&&void 0!==p.extensions[_.KHR_LIGHTS_PUNCTUAL].light?o[_.KHR_LIGHTS_PUNCTUAL].lights[p.extensions[_.KHR_LIGHTS_PUNCTUAL].light]:new THREE.Object3D;if(void 0!==p.name&&(r.name=THREE.PropertyBinding.sanitizeNodeName(p.name)),x(r,p),p.extensions&&w(o,r,p),void 0!==p.matrix){var s=new THREE.Matrix4;s.fromArray(p.matrix),r.applyMatrix(s)}else void 0!==p.translation&&r.position.fromArray(p.translation),void 0!==p.rotation&&r.quaternion.fromArray(p.rotation),void 0!==p.scale&&r.scale.fromArray(p.scale);return r})},C.prototype.loadScene=function(){function R(e,r,t,a,n){var i=a[e],s=t.nodes[e];if(void 0!==s.skin)for(var o=!0===i.isGroup?i.children:[i],l=0,u=o.length;l<u;l++){for(var p=o[l],c=n[s.skin],d=[],h=[],f=0,m=c.joints.length;f<m;f++){var E=c.joints[f],v=a[E];if(v){d.push(v);var T=new THREE.Matrix4;void 0!==c.inverseBindMatrices&&T.fromArray(c.inverseBindMatrices.array,16*f),h.push(T)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',E)}p.bind(new THREE.Skeleton(d,h),p.matrixWorld)}if(r.add(i),s.children){var g=s.children;for(l=0,u=g.length;l<u;l++)R(g[l],i,t,a,n)}}return function(e){var i=this.json,s=this.extensions,o=this.json.scenes[e];return this.getMultiDependencies(["node","skin"]).then(function(e){var r=new THREE.Scene;void 0!==o.name&&(r.name=o.name),x(r,o),o.extensions&&w(s,r,o);for(var t=o.nodes||[],a=0,n=t.length;a<n;a++)R(t[a],r,i,e.nodes,e.skins);return r})}}(),e}();