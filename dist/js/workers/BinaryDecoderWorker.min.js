"use strict";function CustomView(t){this.buffer=t,this.u8=new Uint8Array(t);var e=new ArrayBuffer(4),i=new Float32Array(e),r=new Uint8Array(e);this.getUint32=function(t){return this.u8[t+3]<<24|this.u8[t+2]<<16|this.u8[t+1]<<8|this.u8[t]},this.getUint16=function(t){return this.u8[t+1]<<8|this.u8[t]},this.getFloat32=function(t){return r[0]=this.u8[t+0],r[1]=this.u8[t+1],r[2]=this.u8[t+2],r[3]=this.u8[t+3],i[0]},this.getUint8=function(t){return this.u8[t]}}function Version(t){this.version=t;var e=-1===t.indexOf(".")?t.length:t.indexOf(".");this.versionMajor=parseInt(t.substr(0,e)),this.versionMinor=parseInt(t.substr(e+1)),0===this.versionMinor.length&&(this.versionMinor=0)}onmessage=function(t){var e=t.data.buffer,i=t.data.pointAttributes,r=e.byteLength/i.byteSize,n=new CustomView(e),A=new Version(t.data.version),a=t.data.offset,o=t.data.scale,u=(t.data.spacing,t.data.hasChildren,t.data.name,[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]),s=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],b=[0,0,0],P={},T=0;for(var N of i.attributes){if(N.name===PointAttribute.POSITION_CARTESIAN.name){for(var _=new ArrayBuffer(4*r*3),I=new Float32Array(_),E=0;E<r;E++){A.newerThan("1.3")?(w=n.getUint32(T+E*i.byteSize+0,!0)*o,l=n.getUint32(T+E*i.byteSize+4,!0)*o,F=n.getUint32(T+E*i.byteSize+8,!0)*o):(w=n.getFloat32(E*i.byteSize+0,!0)+a[0],l=n.getFloat32(E*i.byteSize+4,!0)+a[1],F=n.getFloat32(E*i.byteSize+8,!0)+a[2]),I[3*E+0]=w,I[3*E+1]=l,I[3*E+2]=F,b[0]+=w/r,b[1]+=l/r,b[2]+=F/r,u[0]=Math.min(u[0],w),u[1]=Math.min(u[1],l),u[2]=Math.min(u[2],F),s[0]=Math.max(s[0],w),s[1]=Math.max(s[1],l),s[2]=Math.max(s[2],F)}P[N.name]={buffer:_,attribute:N}}else if(N.name===PointAttribute.COLOR_PACKED.name){_=new ArrayBuffer(4*r);for(var f=new Uint8Array(_),E=0;E<r;E++)f[4*E+0]=n.getUint8(T+E*i.byteSize+0),f[4*E+1]=n.getUint8(T+E*i.byteSize+1),f[4*E+2]=n.getUint8(T+E*i.byteSize+2);P[N.name]={buffer:_,attribute:N}}else if(N.name===PointAttribute.INTENSITY.name){_=new ArrayBuffer(4*r);var O=new Float32Array(_);for(E=0;E<r;E++){var h=n.getUint16(T+E*i.byteSize,!0);O[E]=h}P[N.name]={buffer:_,attribute:N}}else if(N.name===PointAttribute.CLASSIFICATION.name){_=new ArrayBuffer(r);var S=new Uint8Array(_);for(E=0;E<r;E++){var y=n.getUint8(T+E*i.byteSize);S[E]=y}P[N.name]={buffer:_,attribute:N}}else if(N.name===PointAttribute.NORMAL_SPHEREMAPPED.name){_=new ArrayBuffer(4*r*3);var m=new Float32Array(_);for(E=0;E<r;E++){var R=2*(n.getUint8(T+E*i.byteSize+0)/255)-1,M=2*(n.getUint8(T+E*i.byteSize+1)/255)-1,L=1,C=R*-R+M*-M+1*L;L=C,R*=Math.sqrt(C),M*=Math.sqrt(C),R*=2,M*=2,L=2*L-1,m[3*E+0]=R,m[3*E+1]=M,m[3*E+2]=L}P[N.name]={buffer:_,attribute:N}}else if(N.name===PointAttribute.NORMAL_OCT16.name){for(_=new ArrayBuffer(4*r*3),m=new Float32Array(_),E=0;E<r;E++){var U=n.getUint8(T+E*i.byteSize+0)/255*2-1,D=n.getUint8(T+E*i.byteSize+1)/255*2-1,w=0,l=0;(F=1-Math.abs(U)-Math.abs(D))>=0?(w=U,l=D):(w=-(D/Math.sign(D)-1)/Math.sign(U),l=-(U/Math.sign(U)-1)/Math.sign(D));var z=Math.sqrt(w*w+l*l+F*F);w/=z,l/=z,F/=z,m[3*E+0]=w,m[3*E+1]=l,m[3*E+2]=F}P[N.name]={buffer:_,attribute:N}}else if(N.name===PointAttribute.NORMAL.name){for(_=new ArrayBuffer(4*r*3),m=new Float32Array(_),E=0;E<r;E++){var w=n.getFloat32(T+E*i.byteSize+0,!0),l=n.getFloat32(T+E*i.byteSize+4,!0),F=n.getFloat32(T+E*i.byteSize+8,!0);m[3*E+0]=w,m[3*E+1]=l,m[3*E+2]=F}P[N.name]={buffer:_,attribute:N}}T+=N.byteSize}_=new ArrayBuffer(4*r);for(var p=new Uint32Array(_),v=0;v<r;v++)p[v]=v;P[PointAttribute.INDICES.name]={buffer:_,attribute:PointAttribute.INDICES};var g={buffer:e,mean:b,attributeBuffers:P,tightBoundingBox:{min:u,max:s}},Y=[];for(var B in g.attributeBuffers)Y.push(g.attributeBuffers[B].buffer);Y.push(e),postMessage(g,Y)},Version.prototype.newerThan=function(t){var e=new Version(t);return this.versionMajor>e.versionMajor||this.versionMajor===e.versionMajor&&this.versionMinor>e.versionMinor};var PointAttributeNames={POSITION_CARTESIAN:0,COLOR_PACKED:1,COLOR_FLOATS_1:2,COLOR_FLOATS_255:3,NORMAL_FLOATS:4,FILLER:5,INTENSITY:6,CLASSIFICATION:7,NORMAL_SPHEREMAPPED:8,NORMAL_OCT16:9,NORMAL:10,RETURN_NUMBER:11,NUMBER_OF_RETURNS:12,SOURCE_ID:13,INDICES:14,SPACING:15},PointAttributeTypes={DATA_TYPE_DOUBLE:{ordinal:0,size:8},DATA_TYPE_FLOAT:{ordinal:1,size:4},DATA_TYPE_INT8:{ordinal:2,size:1},DATA_TYPE_UINT8:{ordinal:3,size:1},DATA_TYPE_INT16:{ordinal:4,size:2},DATA_TYPE_UINT16:{ordinal:5,size:2},DATA_TYPE_INT32:{ordinal:6,size:4},DATA_TYPE_UINT32:{ordinal:7,size:4},DATA_TYPE_INT64:{ordinal:8,size:8},DATA_TYPE_UINT64:{ordinal:9,size:8}},i=0;for(var obj in PointAttributeTypes)PointAttributeTypes[i]=PointAttributeTypes[obj],i++;function PointAttribute(t,e,i){this.name=t,this.type=e,this.numElements=i,this.byteSize=this.numElements*this.type.size}function PointAttributes(t){if(this.attributes=[],this.byteSize=0,this.size=0,null!=t)for(var e=0;e<t.length;e++){var i=PointAttribute[t[e]];this.attributes.push(i),this.byteSize+=i.byteSize,this.size++}}PointAttribute.POSITION_CARTESIAN=new PointAttribute(PointAttributeNames.POSITION_CARTESIAN,PointAttributeTypes.DATA_TYPE_FLOAT,3),PointAttribute.RGBA_PACKED=new PointAttribute(PointAttributeNames.COLOR_PACKED,PointAttributeTypes.DATA_TYPE_INT8,4),PointAttribute.COLOR_PACKED=PointAttribute.RGBA_PACKED,PointAttribute.RGB_PACKED=new PointAttribute(PointAttributeNames.COLOR_PACKED,PointAttributeTypes.DATA_TYPE_INT8,3),PointAttribute.NORMAL_FLOATS=new PointAttribute(PointAttributeNames.NORMAL_FLOATS,PointAttributeTypes.DATA_TYPE_FLOAT,3),PointAttribute.FILLER_1B=new PointAttribute(PointAttributeNames.FILLER,PointAttributeTypes.DATA_TYPE_UINT8,1),PointAttribute.INTENSITY=new PointAttribute(PointAttributeNames.INTENSITY,PointAttributeTypes.DATA_TYPE_UINT16,1),PointAttribute.CLASSIFICATION=new PointAttribute(PointAttributeNames.CLASSIFICATION,PointAttributeTypes.DATA_TYPE_UINT8,1),PointAttribute.NORMAL_SPHEREMAPPED=new PointAttribute(PointAttributeNames.NORMAL_SPHEREMAPPED,PointAttributeTypes.DATA_TYPE_UINT8,2),PointAttribute.NORMAL_OCT16=new PointAttribute(PointAttributeNames.NORMAL_OCT16,PointAttributeTypes.DATA_TYPE_UINT8,2),PointAttribute.NORMAL=new PointAttribute(PointAttributeNames.NORMAL,PointAttributeTypes.DATA_TYPE_FLOAT,3),PointAttribute.RETURN_NUMBER=new PointAttribute(PointAttributeNames.RETURN_NUMBER,PointAttributeTypes.DATA_TYPE_UINT8,1),PointAttribute.NUMBER_OF_RETURNS=new PointAttribute(PointAttributeNames.NUMBER_OF_RETURNS,PointAttributeTypes.DATA_TYPE_UINT8,1),PointAttribute.SOURCE_ID=new PointAttribute(PointAttributeNames.SOURCE_ID,PointAttributeTypes.DATA_TYPE_UINT8,1),PointAttribute.INDICES=new PointAttribute(PointAttributeNames.INDICES,PointAttributeTypes.DATA_TYPE_UINT32,1),PointAttribute.SPACING=new PointAttribute(PointAttributeNames.SPACING,PointAttributeTypes.DATA_TYPE_FLOAT,1),PointAttributes.prototype.add=function(t){this.attributes.push(t),this.byteSize+=t.byteSize,this.size++},PointAttributes.prototype.hasColors=function(){for(var t in this.attributes){if(this.attributes[t].name===PointAttributeNames.COLOR_PACKED)return!0}return!1},PointAttributes.prototype.hasNormals=function(){for(var t in this.attributes){var e=this.attributes[t];if(e===PointAttribute.NORMAL_SPHEREMAPPED||e===PointAttribute.NORMAL_FLOATS||e===PointAttribute.NORMAL||e===PointAttribute.NORMAL_OCT16)return!0}return!1};