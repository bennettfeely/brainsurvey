"use strict";function readUsingTempArrays(r){for(var a=r.data.buffer,n=r.data.numPoints,e=r.data.pointSize,t=r.data.pointFormatID,i=r.data.scale,m=r.data.offset,I=new ArrayBuffer(4),f=new Uint8Array(I),u=new Uint16Array(I),o=new Int32Array(I),s=new Uint8Array(a),w=(new DataView(a),new ArrayBuffer(20*n)),A=(new DataView(w),{min:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],max:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]}),N=[0,0,0],y=new ArrayBuffer(3*n*4),d=new ArrayBuffer(4*n),U=new ArrayBuffer(4*n),c=new ArrayBuffer(n),T=new ArrayBuffer(n),B=new ArrayBuffer(n),b=new ArrayBuffer(2*n),v=new Float32Array(y),x=new Uint8Array(d),g=new Float32Array(U),E=new Uint8Array(c),F=new Uint8Array(T),V=new Uint8Array(B),p=new Uint16Array(b),h=0;h<n;h++){f[0]=s[h*e+0],f[1]=s[h*e+1],f[2]=s[h*e+2],f[3]=s[h*e+3];var l=o[0];f[0]=s[h*e+4],f[1]=s[h*e+5],f[2]=s[h*e+6],f[3]=s[h*e+7];var M=o[0];f[0]=s[h*e+8],f[1]=s[h*e+9],f[2]=s[h*e+10],f[3]=s[h*e+11];var S=o[0];l=l*i[0]+m[0]-r.data.mins[0],M=M*i[1]+m[1]-r.data.mins[1],S=S*i[2]+m[2]-r.data.mins[2],v[3*h+0]=l,v[3*h+1]=M,v[3*h+2]=S,N[0]+=l/n,N[1]+=M/n,N[2]+=S/n,A.min[0]=Math.min(A.min[0],l),A.min[1]=Math.min(A.min[1],M),A.min[2]=Math.min(A.min[2],S),A.max[0]=Math.max(A.max[0],l),A.max[1]=Math.max(A.max[1],M),A.max[2]=Math.max(A.max[2],S),f[0]=s[h*e+12],f[1]=s[h*e+13];var D=u[0];g[h]=D;var Y=7&s[h*e+14];F[h]=Y,V[h]=(56&s[h*pointSize+14])>>3;var _=s[h*e+15];E[h]=_,f[0]=s[h*e+18],f[1]=s[h*e+19];var O=u[0];if(p[h]=O,2===t){f[0]=s[h*e+20],f[1]=s[h*e+21];var P=u[0];f[0]=s[h*e+22],f[1]=s[h*e+23];var G=u[0];f[0]=s[h*e+24],f[1]=s[h*e+25];var R=u[0];P/=256,G/=256,R/=256,x[4*h+0]=P,x[4*h+1]=G,x[4*h+2]=R}}var z=new ArrayBuffer(4*n),j=new Uint32Array(z);for(h=0;h<n;h++)j[h]=h;var k={mean:N,position:y,color:d,intensity:U,classification:c,returnNumber:T,numberOfReturns:B,pointSourceID:b,tightBoundingBox:A,indices:z};postMessage(k,[k.position,k.color,k.intensity,k.classification,k.returnNumber,k.numberOfReturns,k.pointSourceID,k.indices])}function readUsingDataView(r){for(var a=r.data.buffer,n=r.data.numPoints,e=r.data.pointSize,t=r.data.pointFormatID,i=r.data.scale,m=r.data.offset,I=(new Uint8Array(a),new DataView(a)),f=new ArrayBuffer(40*n),u=(new DataView(f),{min:[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],max:[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]}),o=[0,0,0],s=new ArrayBuffer(3*n*4),w=new ArrayBuffer(4*n),A=new ArrayBuffer(4*n),N=new ArrayBuffer(n),y=new ArrayBuffer(n),d=new ArrayBuffer(n),U=new ArrayBuffer(2*n),c=new Float32Array(s),T=new Uint8Array(w),B=new Float32Array(A),b=new Uint8Array(N),v=new Uint8Array(y),x=new Uint8Array(d),g=new Uint16Array(U),E=0;E<n;E++){var F=I.getInt32(E*e+0,!0),V=I.getInt32(E*e+4,!0),p=I.getInt32(E*e+8,!0),h=F*i[0]+m[0]-r.data.mins[0],l=V*i[1]+m[1]-r.data.mins[1],M=p*i[2]+m[2]-r.data.mins[2];c[3*E+0]=h,c[3*E+1]=l,c[3*E+2]=M,o[0]+=h/n,o[1]+=l/n,o[2]+=M/n,u.min[0]=Math.min(u.min[0],h),u.min[1]=Math.min(u.min[1],l),u.min[2]=Math.min(u.min[2],M),u.max[0]=Math.max(u.max[0],h),u.max[1]=Math.max(u.max[1],l),u.max[2]=Math.max(u.max[2],M);var S=I.getUint16(E*e+12,!0);B[E]=S;var D=I.getUint8(E*e+14,!0),Y=7&D,_=(56&D)>>3;v[E]=Y,x[E]=_;var O=I.getUint8(E*e+15,!0);b[E]=O;var P=I.getUint16(E*e+18,!0);if(g[E]=P,2===t){var G=I.getUint16(E*e+20,!0)/256,R=I.getUint16(E*e+22,!0)/256,z=I.getUint16(E*e+24,!0)/256;T[4*E+0]=G,T[4*E+1]=R,T[4*E+2]=z,T[4*E+3]=255}}var j=new ArrayBuffer(4*n),k=new Uint32Array(j);for(E=0;E<n;E++)k[E]=E;var q={mean:o,position:s,color:w,intensity:A,classification:N,returnNumber:y,numberOfReturns:d,pointSourceID:U,tightBoundingBox:u,indices:j};postMessage(q,[q.position,q.color,q.intensity,q.classification,q.returnNumber,q.numberOfReturns,q.pointSourceID,q.indices])}onmessage=readUsingDataView;